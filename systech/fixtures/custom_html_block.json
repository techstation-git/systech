[
 {
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<div class=\"salesperson-dashboard\">\n  <!-- Header -->\n  <div class=\"dashboard-header\">\n    <div>\n      <h2 class=\"dashboard-title\">My Sales Dashboard</h2>\n      <p class=\"dashboard-subtitle\">Current Period - <span id=\"current-period\">--</span></p>\n    </div>\n    <div class=\"salesperson-info\">\n      <div class=\"salesperson-badge\">\n        <span class=\"badge-icon\">üë§</span>\n        <span id=\"salesperson-name\">Loading...</span>\n      </div>\n    </div>\n  </div>\n\n  <!-- Date Filter -->\n  <div class=\"filter-section\">\n    <div class=\"filter-row\">\n      <div class=\"filter-group\">\n        <label class=\"filter-label\">From Date</label>\n        <input type=\"date\" class=\"form-control input-sm\" id=\"filter-from-date\">\n      </div>\n      <div class=\"filter-group\">\n        <label class=\"filter-label\">To Date</label>\n        <input type=\"date\" class=\"form-control input-sm\" id=\"filter-to-date\">\n      </div>\n      <div class=\"filter-actions\">\n        <button class=\"btn btn-primary btn-sm\" onclick=\"applyDateFilter()\">Apply Filter</button>\n        <button class=\"btn btn-default btn-sm\" onclick=\"resetDateFilter()\">Reset</button>\n      </div>\n    </div>\n  </div>\n\n  <!-- Statistics Grid -->\n  <div class=\"stats-grid\">\n    <div class=\"stat-card\">\n      <div class=\"stat-icon\">üìã</div>\n      <div class=\"stat-content\">\n        <div class=\"stat-value\" id=\"stat-orders\">--</div>\n        <div class=\"stat-label\">Orders</div>\n      </div>\n    </div>\n    \n    <div class=\"stat-card\">\n      <div class=\"stat-icon\">üìÑ</div>\n      <div class=\"stat-content\">\n        <div class=\"stat-value\" id=\"stat-invoices\">--</div>\n        <div class=\"stat-label\">Invoices</div>\n      </div>\n    </div>\n    \n    <div class=\"stat-card\">\n      <div class=\"stat-icon\">üì¶</div>\n      <div class=\"stat-content\">\n        <div class=\"stat-value\" id=\"stat-total-items\">--</div>\n        <div class=\"stat-label\">Total Items</div>\n      </div>\n    </div>\n    \n    <div class=\"stat-card\">\n      <div class=\"stat-icon\">üîí</div>\n      <div class=\"stat-content\">\n        <div class=\"stat-value\" id=\"stat-locked-items\">--</div>\n        <div class=\"stat-label\">Locked Orders</div>\n      </div>\n    </div>\n  </div>\n\n  <!-- Brand Stock Section -->\n  <div class=\"section-card\">\n    <div class=\"section-header\">\n      <h3 class=\"section-title\">Stock Overview by Brand</h3>\n    </div>\n    <div class=\"brand-grid\" id=\"brand-stock-container\">\n      <div class=\"loading-state\">Loading stock data...</div>\n    </div>\n  </div>\n\n  <!-- Last Updated -->\n  <div class=\"dashboard-footer\">\n    <button class=\"btn btn-primary btn-sm refresh-btn\" onclick=\"refreshSalespersonDashboard()\">\n      <span class=\"refresh-icon\">üîÑ</span> Refresh Data\n    </button>\n    <div class=\"last-updated\">Last updated: <span id=\"last-update-time\">--</span></div>\n  </div>\n</div>",
  "modified": "2026-02-02 07:52:19.066656",
  "name": "Sales Person Dashboard",
  "private": 0,
  "roles": [
   {
    "parent": "Sales Person Dashboard",
    "parentfield": "roles",
    "parenttype": "Custom HTML Block",
    "role": "Sales Manager"
   },
   {
    "parent": "Sales Person Dashboard",
    "parentfield": "roles",
    "parenttype": "Custom HTML Block",
    "role": "Sales User"
   }
  ],
  "script": "frappe.provide('salesperson_dashboard');\n\nsalesperson_dashboard = {\n  root: null,\n  data: null,\n  \n  // Initialize the dashboard\n  init: function(root_element) {\n    this.root = root_element;\n    this.initializeDateFilters();\n    this.loadDashboardData();\n    this.updateTimestamp();\n    \n    // Auto-refresh every 5 minutes\n    setInterval(() => {\n      this.loadDashboardData();\n      this.updateTimestamp();\n    }, 300000);\n  },\n  \n  // Initialize date filters with current month\n  initializeDateFilters: function() {\n    const today = new Date();\n    const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);\n    const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);\n    \n    const fromDateInput = this.root.querySelector('#filter-from-date');\n    const toDateInput = this.root.querySelector('#filter-to-date');\n    \n    if (fromDateInput) {\n      fromDateInput.value = frappe.datetime.obj_to_str(firstDay);\n    }\n    if (toDateInput) {\n      toDateInput.value = frappe.datetime.obj_to_str(lastDay);\n    }\n  },\n  \n  // Get current date filter values\n  getDateFilters: function() {\n    const fromDateInput = this.root.querySelector('#filter-from-date');\n    const toDateInput = this.root.querySelector('#filter-to-date');\n    \n    return {\n      from_date: fromDateInput ? fromDateInput.value : null,\n      to_date: toDateInput ? toDateInput.value : null\n    };\n  },\n  \n  // Update the last updated timestamp\n  updateTimestamp: function() {\n    const now = new Date();\n    const timeString = now.toLocaleString('en-US', {\n      hour: '2-digit',\n      minute: '2-digit',\n      second: '2-digit',\n      hour12: true\n    });\n    const updateEl = this.root.querySelector('#last-update-time');\n    if (updateEl) {\n      updateEl.textContent = timeString;\n    }\n  },\n  \n  // Load all dashboard data\n  loadDashboardData: function() {\n    const filters = this.getDateFilters();\n    \n    // Validate date range\n    if (filters.from_date && filters.to_date) {\n      if (new Date(filters.from_date) > new Date(filters.to_date)) {\n        frappe.msgprint({\n          title: __('Invalid Date Range'),\n          message: __('From Date cannot be after To Date'),\n          indicator: 'red'\n        });\n        return;\n      }\n    }\n    \n    frappe.call({\n      method: 'systech.services.api.get_salesperson_dashboard_data',\n      args: {\n        from_date: filters.from_date,\n        to_date: filters.to_date\n      },\n      callback: (r) => {\n        if (r.message) {\n          this.data = r.message;\n          this.updateDashboard(r.message);\n        }\n      },\n      error: (r) => {\n        console.error('Error loading salesperson dashboard data:', r);\n        const dashboard = this.root.querySelector('.salesperson-dashboard');\n        if (dashboard) {\n          dashboard.innerHTML = \n            '<div class=\"text-center\" style=\"padding: 60px; background: white; border-radius: 4px; margin: 24px; border: 1px solid #d1d8dd;\">' +\n            '<h3 style=\"color: #d74b4b; margin-bottom: 12px;\">‚ö†Ô∏è Error Loading Dashboard</h3>' +\n            '<p style=\"color: #6c7680;\">Unable to load your sales data. Please try again or contact support.</p>' +\n            '</div>';\n        }\n      }\n    });\n  },\n  \n  // Update dashboard with data\n  updateDashboard: function(data) {\n    const stats = data.stats;\n    const salesperson = data.salesperson;\n    const period = data.period;\n    const categoryStock = data.category_stock || [];\n    \n    // Update salesperson name\n    this.updateElement('#salesperson-name', salesperson || 'Not Assigned');\n    \n    // Update period\n    const periodText = this.formatDate(period.start) + ' - ' + this.formatDate(period.end);\n    this.updateElement('#current-period', periodText);\n    \n    // Update statistics (excluding monetary values)\n    this.updateElement('#stat-orders', stats.orders || 0);\n    this.updateElement('#stat-invoices', stats.invoices || 0);\n    this.updateElement('#stat-total-items', this.formatNumber(stats.total_items));\n    this.updateElement('#stat-locked-items', stats.locked_items || 0);\n\n    // Update Brand Stock Section (excluding values)\n    this.updateBrandStock(categoryStock);\n  },\n\n  // Update Stock Logic (without price information)\n  updateBrandStock: function(items) {\n    const container = this.root.querySelector('#brand-stock-container');\n    if (!container) return;\n    \n    container.innerHTML = '';\n    \n    if (!items || items.length === 0) {\n      container.innerHTML = '<div class=\"text-center\" style=\"grid-column: 1/-1; padding: 20px; color: #6c7680;\">No stock data found</div>';\n      return;\n    }\n    \n    items.forEach(item => {\n      const card = document.createElement('div');\n      card.className = 'brand-card';\n      card.innerHTML = `\n        <div class=\"brand-header\">\n          <h4 class=\"brand-name\">${item.group_name || 'Uncategorized'}</h4>\n          <span class=\"brand-items-count\">${item.total_items} Items</span>\n        </div>\n        <div class=\"brand-stats\">\n          <div class=\"brand-stat-row\">\n            <span class=\"brand-stat-label\">Stock Qty</span>\n            <span class=\"brand-stat-value\">${this.formatNumber(item.total_qty)}</span>\n          </div>\n        </div>\n      `;\n      container.appendChild(card);\n    });\n  },\n  \n  // Helper to update element text\n  updateElement: function(selector, text) {\n    const el = this.root.querySelector(selector);\n    if (el) {\n      el.textContent = text;\n    }\n  },\n  \n  // Helper function to format number\n  formatNumber: function(num) {\n    if (num == null || num === undefined) return '0';\n    return parseFloat(num).toLocaleString('en-US', {\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 2\n    });\n  },\n  \n  // Helper function to format date\n  formatDate: function(dateStr) {\n    if (!dateStr) return '-';\n    return frappe.datetime.str_to_user(dateStr);\n  },\n  \n  // Refresh data\n  refresh: function() {\n    this.loadDashboardData();\n    this.updateTimestamp();\n  }\n};\n\n// Apply date filter\nwindow.applyDateFilter = function() {\n  if (salesperson_dashboard.root) {\n    salesperson_dashboard.refresh();\n  }\n};\n\n// Reset date filter to current month\nwindow.resetDateFilter = function() {\n  if (salesperson_dashboard.root) {\n    salesperson_dashboard.initializeDateFilters();\n    salesperson_dashboard.refresh();\n  }\n};\n\n// Attach refresh function to window for button onclick handler\nwindow.refreshSalespersonDashboard = function() {\n  if (salesperson_dashboard.root) {\n    salesperson_dashboard.refresh();\n  }\n};\n\n// Initialize dashboard using root_element\nsalesperson_dashboard.init(root_element);",
  "style": ".salesperson-dashboard {\n  font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Roboto\", \"Oxygen\", \"Ubuntu\", \"Cantarell\", \"Fira Sans\", \"Droid Sans\", \"Helvetica Neue\", sans-serif;\n  padding: 15px;\n  background: #f5f7fa;\n  min-height: 100vh;\n}\n\n/* Header Styles */\n.dashboard-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 15px;\n  padding: 15px;\n  background: white;\n  border-radius: 4px;\n  border: 1px solid #d1d8dd;\n}\n\n.dashboard-title {\n  font-size: 20px;\n  font-weight: 600;\n  color: #2e3338;\n  margin: 0 0 5px 0;\n}\n\n.dashboard-subtitle {\n  font-size: 13px;\n  color: #6c7680;\n  font-weight: 400;\n  margin: 0;\n}\n\n.salesperson-info {\n  display: flex;\n  align-items: center;\n}\n\n.salesperson-badge {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  background: #f5f7fa;\n  padding: 8px 12px;\n  border-radius: 4px;\n  font-weight: 500;\n  color: #2e3338;\n  border: 1px solid #d1d8dd;\n  font-size: 13px;\n}\n\n.badge-icon {\n  font-size: 18px;\n}\n\n/* Filter Section */\n.filter-section {\n  background: white;\n  border: 1px solid #d1d8dd;\n  border-radius: 4px;\n  padding: 15px;\n  margin-bottom: 15px;\n}\n\n.filter-row {\n  display: flex;\n  align-items: flex-end;\n  gap: 15px;\n  flex-wrap: wrap;\n}\n\n.filter-group {\n  display: flex;\n  flex-direction: column;\n  gap: 5px;\n  min-width: 180px;\n}\n\n.filter-label {\n  font-size: 13px;\n  color: #6c7680;\n  font-weight: 500;\n  margin: 0;\n}\n\n.filter-actions {\n  display: flex;\n  gap: 8px;\n  align-items: center;\n}\n\n/* Stats Grid */\n.stats-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n  gap: 15px;\n  margin-bottom: 20px;\n}\n\n.stat-card {\n  background: white;\n  border-radius: 4px;\n  padding: 15px;\n  display: flex;\n  align-items: center;\n  gap: 15px;\n  border: 1px solid #d1d8dd;\n  transition: box-shadow 0.2s ease;\n}\n\n.stat-card:hover {\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);\n}\n\n.stat-icon {\n  font-size: 32px;\n  line-height: 1;\n  opacity: 0.9;\n}\n\n.stat-content {\n  flex: 1;\n}\n\n.stat-value {\n  font-size: 24px;\n  font-weight: 600;\n  color: #2e3338;\n  line-height: 1.2;\n  margin-bottom: 4px;\n}\n\n.stat-label {\n  font-size: 13px;\n  color: #6c7680;\n  font-weight: 400;\n  text-transform: none;\n}\n\n/* Brand Stock Section */\n.section-card {\n  background: white;\n  border-radius: 4px;\n  padding: 15px;\n  margin-bottom: 15px;\n  border: 1px solid #d1d8dd;\n}\n\n.section-header {\n  margin-bottom: 15px;\n  padding-bottom: 10px;\n  border-bottom: 1px solid #ebeff2;\n}\n\n.section-title {\n  font-size: 16px;\n  font-weight: 600;\n  color: #2e3338;\n  margin: 0;\n}\n\n.brand-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));\n  gap: 15px;\n}\n\n.brand-card {\n  background: #f5f7fa;\n  border: 1px solid #d1d8dd;\n  border-radius: 4px;\n  padding: 15px;\n  transition: all 0.2s ease;\n}\n\n.brand-card:hover {\n  background: white;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);\n}\n\n.brand-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 12px;\n  padding-bottom: 10px;\n  border-bottom: 1px solid #d1d8dd;\n}\n\n.brand-name {\n  font-size: 14px;\n  font-weight: 600;\n  color: #2e3338;\n  margin: 0;\n}\n\n.brand-items-count {\n  font-size: 11px;\n  color: #6c7680;\n  background: white;\n  padding: 2px 6px;\n  border-radius: 3px;\n  font-weight: 500;\n  border: 1px solid #d1d8dd;\n}\n\n.brand-stats {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n}\n\n.brand-stat-row {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  font-size: 13px;\n}\n\n.brand-stat-label {\n  color: #6c7680;\n}\n\n.brand-stat-value {\n  font-weight: 600;\n  color: #2e3338;\n}\n\n.loading-state {\n  text-align: center;\n  padding: 20px;\n  color: #6c7680;\n  font-size: 13px;\n}\n\n/* Dashboard Footer */\n.dashboard-footer {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 15px;\n  background: white;\n  border-radius: 4px;\n  border: 1px solid #d1d8dd;\n}\n\n.refresh-btn {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n}\n\n.refresh-icon {\n  display: inline-block;\n  font-size: 14px;\n}\n\n.last-updated {\n  font-size: 13px;\n  color: #6c7680;\n  font-weight: 400;\n}\n\n/* Responsive Design */\n@media (max-width: 768px) {\n  .salesperson-dashboard {\n    padding: 10px;\n  }\n  \n  .dashboard-header {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 12px;\n  }\n  \n  .dashboard-title {\n    font-size: 18px;\n  }\n  \n  .filter-row {\n    flex-direction: column;\n    align-items: stretch;\n  }\n  \n  .filter-group {\n    width: 100%;\n  }\n  \n  .filter-actions {\n    width: 100%;\n  }\n  \n  .filter-actions button {\n    flex: 1;\n  }\n  \n  .stats-grid {\n    grid-template-columns: 1fr;\n    gap: 10px;\n  }\n  \n  .dashboard-footer {\n    flex-direction: column;\n    gap: 12px;\n    align-items: stretch;\n  }\n  \n  .refresh-btn {\n    justify-content: center;\n  }\n}"
 },
 {
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<div id=\"sales-dashboard-container\" class=\"dashboard-wrapper\">\n    <!-- Header Section -->\n    <div class=\"dashboard-header\">\n        <div class=\"welcome-text\">\n            <h2 id=\"sp-name\">Loading...</h2>\n            <p id=\"sp-period\">Current Month Performance</p>\n        </div>\n        <button class=\"refresh-btn\" onclick=\"refreshDashboard()\">\n            <span class=\"refresh-icon\">üîÑ</span> Refresh\n        </button>\n    </div>\n\n    <!-- Stats Cards -->\n    <div class=\"stats-grid\">\n        <div class=\"stat-card orders\">\n            <div class=\"card-icon\">üì¶</div>\n            <div class=\"card-info\">\n                <span class=\"label\">Total Orders</span>\n                <h3 id=\"stat-orders\">0</h3>\n            </div>\n        </div>\n        <div class=\"stat-card locked\">\n            <div class=\"card-icon\">üîí</div>\n            <div class=\"card-info\">\n                <span class=\"label\">Locked Items</span>\n                <h3 id=\"stat-locked-qty\">0</h3>\n                <small id=\"stat-locked-count\">0 Orders</small>\n            </div>\n        </div>\n        <div class=\"stat-card commission\">\n            <div class=\"card-icon\">üí∞</div>\n            <div class=\"card-info\">\n                <span class=\"label\">Est. Commission</span>\n                <h3 id=\"stat-commission\">0.00</h3>\n                <p id=\"target-badge\" class=\"badge\">Checking Target...</p>\n            </div>\n        </div>\n    </div>\n\n    <!-- Details Section -->\n    <div class=\"details-section\">\n        <div class=\"section-header\">\n            <h3>üîí Locked Items Details</h3>\n            <span class=\"info-tip\">Awaiting Dispatch / Manager Approval</span>\n        </div>\n        <div class=\"table-container\">\n            <table class=\"details-table\">\n                <thead>\n                    <tr>\n                        <th>Order ID</th>\n                        <th>Customer</th>\n                        <th>Total Qty</th>\n                        <th>Date</th>\n                    </tr>\n                </thead>\n                <tbody id=\"locked-items-body\">\n                    <tr><td colspan=\"4\" class=\"empty-state\">No locked items found.</td></tr>\n                </tbody>\n            </table>\n        </div>\n    </div>\n</div>",
  "modified": "2026-01-18 12:22:46.909570",
  "name": "Sales Performance Dashboard",
  "private": 0,
  "roles": [],
  "script": "// 1. Capture the local root_element immediately\n(function(root) {\n    if (!root) return;\n\n    // 2. Define the update function\n    const refreshData = () => {\n        // Target our internal container for the loading effect\n        const container = root.querySelector('#sales-dashboard-container');\n        if (container) container.style.opacity = '0.5';\n        \n        frappe.call({\n            method: \"systech.services.api.get_salesperson_dashboard_data\",\n            callback: (r) => {\n                if (container) container.style.opacity = '1';\n                if (!r.message) return;\n\n                const { stats, salesperson, locked_items_details } = r.message;\n                const items = locked_items_details || [];\n\n                // Helper to update text safely inside this root\n                const set = (sel, val) => {\n                    const el = root.querySelector(sel);\n                    if (el) el.innerText = val;\n                };\n\n                // Update Header & Stats\n                set('#sp-name', `Welcome, ${salesperson || 'Salesperson'}`);\n                set('#stat-orders', stats.orders || 0);\n                set('#stat-locked-qty', stats.locked_items || 0);\n                set('#stat-locked-count', `${items.length} Locked Orders`);\n\n                // Commission (10% + 7% logic)\n                const isMet = stats.total_sales >= stats.sales_target;\n                const rate = isMet ? 17 : 10;\n                const totalComm = (stats.total_sales * rate) / 100;\n                set('#stat-commission', format_currency(totalComm, stats.currency));\n\n                // Update Badge\n                const badge = root.querySelector('#target-badge');\n                if (badge) {\n                    badge.innerText = isMet ? `üî• Bonus Unlocked (${rate}%)` : `Standard Rate (${rate}%)`;\n                    badge.className = isMet ? 'badge target-met' : 'badge';\n                }\n\n                // Update Table\n                const tbody = root.querySelector('#locked-items-body');\n                if (tbody) {\n                    tbody.innerHTML = items.length ? items.map(i => `\n                        <tr>\n                            <td><strong>${i.name}</strong></td>\n                            <td>${i.customer}</td>\n                            <td>${i.qty} units</td>\n                            <td>${frappe.datetime.global_date_format(i.date)}</td>\n                        </tr>\n                    `).join('') : '<tr><td colspan=\"4\" class=\"empty-state\">No locked items found.</td></tr>';\n                }\n            }\n        });\n    };\n\n    // 3. Bind the refresh button using the root reference\n    // We use a small timeout to ensure the HTML is rendered before we search for the button\n    setTimeout(() => {\n        const btn = root.querySelector('.refresh-btn');\n        if (btn) {\n            btn.onclick = () => refreshData();\n        }\n        refreshData(); // Run initial load\n    }, 50);\n\n})(root_element);",
  "style": ":root {\n    --bg-card: rgba(255, 255, 255, 0.05);\n    --accent-blue: #3b82f6;\n    --accent-gold: #f59e0b;\n    --accent-green: #10b981;\n    --text-main: #f3f4f6;\n    --text-muted: #9ca3af;\n    --glass-border: rgba(255, 255, 255, 0.1);\n}\n\n.dashboard-wrapper {\n    font-family: 'Inter', -apple-system, sans-serif;\n    color: var(--text-main);\n    padding: 20px;\n}\n\n/* Header */\n.dashboard-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 24px;\n}\n\n.welcome-text h2 { margin: 0; font-size: 1.5rem; letter-spacing: -0.025em; }\n.welcome-text p { margin: 4px 0 0; color: var(--text-muted); font-size: 0.9rem; }\n\n.refresh-btn {\n    background: var(--accent-blue);\n    color: white;\n    border: none;\n    padding: 8px 16px;\n    border-radius: 8px;\n    cursor: pointer;\n    font-weight: 500;\n    transition: transform 0.2s;\n}\n\n.refresh-btn:hover { transform: scale(1.05); }\n\n/* Stats Grid */\n.stats-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));\n    gap: 16px;\n    margin-bottom: 32px;\n}\n\n.stat-card {\n    background: var(--bg-card);\n    border: 1px solid var(--glass-border);\n    border-radius: 12px;\n    padding: 20px;\n    display: flex;\n    align-items: center;\n    gap: 16px;\n    backdrop-filter: blur(10px);\n}\n\n.card-icon {\n    font-size: 2rem;\n    background: rgba(255, 255, 255, 0.05);\n    width: 60px;\n    height: 60px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: 10px;\n}\n\n.card-info .label { font-size: 0.85rem; color: var(--text-muted); }\n.card-info h3 { margin: 4px 0; font-size: 1.4rem; }\n.card-info small { color: var(--accent-gold); font-weight: 500; }\n\n.badge {\n    display: inline-block;\n    padding: 2px 8px;\n    border-radius: 4px;\n    font-size: 0.75rem;\n    margin-top: 4px;\n    background: rgba(255, 255, 255, 0.1);\n}\n\n.target-met { border: 1px solid var(--accent-green); color: var(--accent-green); }\n\n/* Details Table */\n.details-section {\n    background: var(--bg-card);\n    border: 1px solid var(--glass-border);\n    border-radius: 12px;\n    overflow: hidden;\n}\n\n.section-header {\n    padding: 16px 20px;\n    border-bottom: 1px solid var(--glass-border);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.section-header h3 { margin: 0; font-size: 1rem; }\n.info-tip { font-size: 0.8rem; color: var(--text-muted); font-style: italic; }\n\n.table-container { overflow-x: auto; }\n\n.details-table {\n    width: 100%;\n    border-collapse: collapse;\n    text-align: left;\n    font-size: 0.9rem;\n}\n\n.details-table th {\n    padding: 14px 20px;\n    background: rgba(254, 254, 254, 0.02);\n    font-weight: 600;\n    color: var(--text-muted);\n}\n\n.details-table td {\n    padding: 12px 20px;\n    border-bottom: 1px solid var(--glass-border);\n}\n\n.details-table tbody tr:hover { background: rgba(255, 255, 255, 0.02); }\n\n.empty-state { text-align: center; color: var(--text-muted); padding: 40px !important; }"
 },
 {
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<div class=\"srd-dashboard\">\n    <div class=\"srd-header\">\n        <h4 class=\"srd-title\">Stock Release Console</h4>\n        <div class=\"srd-actions\">\n            <button class=\"btn btn-default btn-sm btn-refresh icon-btn\" title=\"Refresh\">\n                <svg class=\"icon icon-sm\"><use href=\"#icon-refresh\"></use></svg>\n            </button>\n        </div>\n    </div>\n    <!-- Stats Cards -->\n    <div class=\"row srd-stats\">\n        <div class=\"col-xs-4\">\n            <div class=\"srd-card card-release\" data-state=\"Release Requested\">\n                <div class=\"srd-icon-bg\">\n                    <svg class=\"icon icon-xl\"><use href=\"#icon-unlock\"></use></svg>\n                </div>\n                <div class=\"srd-card-content\">\n                    <div class=\"srd-card-count\" id=\"count-release\">0</div>\n                    <div class=\"srd-card-label\">Release Requested</div>\n                    <div class=\"srd-indicator\"></div>\n                </div>\n            </div>\n        </div>\n        <div class=\"col-xs-4\">\n            <div class=\"srd-card card-approval\" data-state=\"Pending Manager Approval\">\n                <div class=\"srd-icon-bg\">\n                    <svg class=\"icon icon-xl\"><use href=\"#icon-review\"></use></svg>\n                </div>\n                <div class=\"srd-card-content\">\n                    <div class=\"srd-card-count\" id=\"count-approval\">0</div>\n                    <div class=\"srd-card-label\">Pending Approval</div>\n                    <div class=\"srd-indicator\"></div>\n                </div>\n            </div>\n        </div>\n        <div class=\"col-xs-4\">\n            <div class=\"srd-card card-locked\" data-state=\"Locked\">\n                 <div class=\"srd-icon-bg\">\n                    <svg class=\"icon icon-xl\"><use href=\"#icon-lock\"></use></svg>\n                </div>\n                <div class=\"srd-card-content\">\n                    <div class=\"srd-card-count\">\n                        <span id=\"count-locked\">0</span>\n                        <small class=\"text-muted qty-badge\" title=\"Total Reserved Quantity\">\n                            <svg class=\"icon icon-xs\"><use href=\"#icon-box\"></use></svg> <span id=\"qty-locked\">0</span>\n                        </small>\n                    </div>\n                    <div class=\"srd-card-label\">Reserved Stock</div>\n                    <div class=\"srd-indicator\"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <!-- List -->\n    <div class=\"srd-body\">\n        <div class=\"table-responsive\">\n            <table class=\"table srd-table\">\n                <thead>\n                    <tr>\n                        <th style=\"width: 20%\">Sales Order</th>\n                        <th style=\"width: 20%\">Customer</th>\n                        <th style=\"width: 15%\">Salesperson</th>\n                        <th style=\"width: 15%\">Date</th>\n                        <th style=\"width: 15%\" class=\"text-right\">Amount</th>\n                        <th style=\"width: 15%\" class=\"text-right\">Action</th>\n                    </tr>\n                </thead>\n                <tbody id=\"srd-table-body\">\n                    <tr><td colspan=\"6\" class=\"text-center text-muted p-5\">Loading data...</td></tr>\n                </tbody>\n            </table>\n        </div>\n        <!-- Pagination Controls -->\n        <div class=\"srd-pagination\">\n            <div class=\"srd-page-info\">\n                <span id=\"page-info\">Showing 0 of 0</span>\n            </div>\n            <div class=\"srd-page-controls\">\n                <button class=\"btn btn-default btn-sm btn-page-prev\" disabled>\n                    <svg class=\"icon icon-xs\"><use href=\"#icon-left\"></use></svg> Prev\n                </button>\n                <span class=\"srd-page-number\">Page <span id=\"current-page\">1</span></span>\n                <button class=\"btn btn-default btn-sm btn-page-next\" disabled>\n                    Next <svg class=\"icon icon-xs\"><use href=\"#icon-right\"></use></svg>\n                </button>\n            </div>\n        </div>\n    </div>\n</div>",
  "modified": "2026-02-01 09:50:50.129925",
  "name": "Sales Manager Dashboard",
  "private": 0,
  "roles": [
   {
    "parent": "Sales Manager Dashboard",
    "parentfield": "roles",
    "parenttype": "Custom HTML Block",
    "role": "Sales Manager"
   }
  ],
  "script": "const $root = $(root_element);\nconst $tbody = $root.find('#srd-table-body');\nconst $refreshBtn = $root.find('.btn-refresh');\nconst $cards = $root.find('.srd-card');\nconst $btnPrev = $root.find('.btn-page-prev');\nconst $btnNext = $root.find('.btn-page-next');\nconst $pageInfo = $root.find('#page-info');\nconst $currentPage = $root.find('#current-page');\n\nlet currentState = 'Release Requested';\nlet allData = [];\nlet currentPage = 1;\nconst rowsPerPage = 5;\n\n// Set initial active state visual\n$root.find(`.srd-card[data-state=\"${currentState}\"]`).addClass('active');\n\nfunction refreshDashboard() {\n    loadStats();\n    loadList(currentState);\n}\n\nfunction loadStats() {\n    frappe.call({\n        method: 'systech.services.rest.get_dashboard_stats',\n        callback: function(r) {\n            if (r.message) {\n                const s = r.message;\n                $root.find('#count-release').text(s.release || 0);\n                $root.find('#count-approval').text(s.approval || 0);\n                $root.find('#count-locked').text(s.locked_count || 0);\n                $root.find('#qty-locked').text(s.locked_qty || 0);\n            }\n        }\n    });\n}\n\nfunction loadList(state) {\n    currentState = state;\n    currentPage = 1;\n    allData = [];\n    $tbody.html('<tr><td colspan=\"6\" class=\"text-center text-muted p-5\">Loading...</td></tr>');\n    \n    // Update active card visual\n    $cards.removeClass('active');\n    $root.find(`.srd-card[data-state=\"${state}\"]`).addClass('active');\n    \n    frappe.call({\n        method: 'systech.services.rest.get_stock_release_list',\n        args: {\n            workflow_state: state\n        },\n        callback: function(r) {\n            if (r.message && r.message.length > 0) {\n                allData = r.message;\n                renderPage();\n            } else {\n                allData = [];\n                $tbody.html('<tr><td colspan=\"6\" class=\"text-center text-muted p-5\">No records found.</td></tr>');\n                updatePaginationControls();\n            }\n        }\n    });\n}\n\nfunction renderPage() {\n    const totalRows = allData.length;\n    const totalPages = Math.ceil(totalRows / rowsPerPage);\n    const startIndex = (currentPage - 1) * rowsPerPage;\n    const endIndex = Math.min(startIndex + rowsPerPage, totalRows);\n    const pageData = allData.slice(startIndex, endIndex);\n    \n    renderTable(pageData);\n    updatePaginationControls();\n    \n    // Update page info\n    if (totalRows > 0) {\n        $pageInfo.text(`Showing ${startIndex + 1}-${endIndex} of ${totalRows}`);\n    } else {\n        $pageInfo.text('Showing 0 of 0');\n    }\n    $currentPage.text(currentPage);\n}\n\nfunction renderTable(data) {\n    let rows = '';\n    \n    // Determine Action Button configuration\n    let actionLabel = '';\n    let actionMethod = ''; \n    let actionCmd = '';\n    let btnClass = '';\n    let btnIcon = '';\n    \n    if (currentState === 'Release Requested') {\n        actionLabel = 'Release';\n        actionMethod = 'workflow';\n        actionCmd = 'Release';\n        btnClass = 'btn-success-subtle';\n        btnIcon = 'unlock';\n    } else if (currentState === 'Pending Manager Approval') {\n        actionLabel = 'Approve';\n        actionMethod = 'workflow';\n        actionCmd = 'Approve';\n        btnClass = 'btn-primary-subtle';\n        btnIcon = 'check';\n    } else if (currentState === 'Locked') {\n        actionLabel = 'Unreserve';\n        actionMethod = 'unreserve'; \n        btnClass = 'btn-danger-subtle';\n        btnIcon = 'x';\n    }\n    \n    data.forEach(d => {\n        const date = frappe.datetime.str_to_user(d.transaction_date);\n        const amount = format_currency(d.grand_total, d.currency);\n        const salesperson = d.sales_person || '-';\n        \n        let actionBtnHtml = '';\n        if (actionLabel) {\n             actionBtnHtml = `\n                <button class=\"btn btn-xs ${btnClass} btn-action\" \n                    data-name=\"${d.name}\" \n                    data-method=\"${actionMethod}\"\n                    data-cmd=\"${actionCmd}\">\n                    <svg class=\"icon icon-xs\"><use href=\"#icon-${btnIcon}\"></use></svg> ${actionLabel}\n                </button>\n             `;\n        }\n        \n        rows += `\n            <tr>\n                <td>\n                    <a href=\"/app/sales-order/${d.name}\" class=\"fw-bold text-dark\" style=\"font-weight:600;\" data-doctype=\"Sales Order\" data-name=\"${d.name}\">\n                        ${d.name}\n                    </a>\n                </td>\n                <td>\n                    <span class=\"text-muted text-truncate\" style=\"max-width: 200px; display:inline-block; vertical-align:middle;\">\n                        ${d.customer}\n                    </span>\n                </td>\n                <td>\n                    <span class=\"text-muted text-truncate\" style=\"max-width: 150px; display:inline-block; vertical-align:middle;\">\n                        ${salesperson}\n                    </span>\n                </td>\n                <td><span class=\"badge badge-date\">${date}</span></td>\n                <td class=\"text-right font-weight-bold\">${amount}</td>\n                <td class=\"text-right\">${actionBtnHtml}</td>\n            </tr>\n        `;\n    });\n    \n    $tbody.html(rows);\n    \n    $tbody.find('.btn-action').on('click', function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const sales_order = $(this).data('name');\n        const method = $(this).data('method');\n        const cmd = $(this).data('cmd');\n        \n        if (method === 'unreserve') {\n            processUnreserve(sales_order);\n        } else {\n            processWorkflow(sales_order, cmd);\n        }\n    });\n}\n\nfunction updatePaginationControls() {\n    const totalRows = allData.length;\n    const totalPages = Math.ceil(totalRows / rowsPerPage);\n    \n    // Enable/disable previous button\n    $btnPrev.prop('disabled', currentPage <= 1);\n    \n    // Enable/disable next button\n    $btnNext.prop('disabled', currentPage >= totalPages || totalRows === 0);\n}\n\nfunction processWorkflow(sales_order, action) {\n    frappe.confirm(`Are you sure you want to <b>${action}</b> ${sales_order}?`, () => {\n        frappe.call({\n            method: 'systech.services.rest.process_workflow_action',\n            args: { docname: sales_order, action: action },\n            freeze: true,\n            callback: function(r) {\n                if (!r.exc) {\n                    frappe.show_alert({message: __('Action applied successfully'), indicator: 'green'});\n                    refreshDashboard();\n                }\n            }\n        });\n    });\n}\n\nfunction processUnreserve(sales_order) {\n    frappe.confirm(`Are you sure you want to <b>Unreserve and Close</b> ${sales_order}?`, () => {\n        frappe.call({\n            method: 'systech.services.rest.unreserve_stock',\n            args: { sales_order_name: sales_order },\n            freeze: true,\n            callback: function(r) {\n                if (!r.exc) {\n                    frappe.show_alert({message: __('Stock Unreserved'), indicator: 'orange'});\n                    refreshDashboard();\n                }\n            }\n        });\n    });\n}\n\n// Event Listeners\n$refreshBtn.on('click', function(e) {\n    e.preventDefault();\n    refreshDashboard();\n});\n\n$cards.on('click', function() {\n    const state = $(this).data('state');\n    loadList(state);\n});\n\n$btnPrev.on('click', function(e) {\n    e.preventDefault();\n    if (currentPage > 1) {\n        currentPage--;\n        renderPage();\n    }\n});\n\n$btnNext.on('click', function(e) {\n    e.preventDefault();\n    const totalPages = Math.ceil(allData.length / rowsPerPage);\n    if (currentPage < totalPages) {\n        currentPage++;\n        renderPage();\n    }\n});\n\n// Initial load\nrefreshDashboard();",
  "style": "/* Layout & Basics */\n.srd-dashboard {\n    font-family: 'Inter', -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n    color: var(--text-color);\n}\n.srd-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 25px;\n    padding: 0 5px;\n}\n.srd-title {\n    margin: 0;\n    font-size: 20px;\n    font-weight: 700;\n    letter-spacing: -0.5px;\n}\n\n/* Cards Container - FORCED SINGLE ROW */\n.srd-stats {\n    display: flex !important;\n    flex-wrap: nowrap !important;\n    gap: 20px;\n    margin-bottom: 30px;\n    margin-left: 0; \n    margin-right: 0;\n    width: 100%;\n}\n.srd-stats > div {\n    flex: 1;\n    max-width: 33.33%;\n    padding-left: 0 !important;\n    padding-right: 0 !important;\n    margin-bottom: 0 !important;\n}\n\n/* Base Card Style */\n.srd-card {\n    background: var(--card-bg);\n    padding: 24px;\n    border-radius: 16px;\n    position: relative;\n    overflow: hidden;\n    cursor: pointer;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.03);\n    border: 1px solid var(--border-color);\n    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n}\n\n.srd-card:hover {\n    transform: translateY(-4px);\n    box-shadow: 0 12px 24px rgba(0,0,0,0.06);\n}\n\n.srd-card.active {\n    border-color: transparent;\n    box-shadow: 0 8px 20px rgba(0,0,0,0.08);\n}\n.srd-card.active .srd-indicator {\n    width: 60%; \n    opacity: 1;\n}\n\n.srd-icon-bg {\n    position: absolute;\n    right: -10px;\n    top: -10px;\n    opacity: 0.05;\n    transform: rotate(15deg) scale(1.5);\n    transition: all 0.5s ease;\n}\n.srd-card:hover .srd-icon-bg {\n    transform: rotate(0deg) scale(1.6);\n    opacity: 0.08;\n}\n\n.srd-card-count {\n    font-size: 32px;\n    font-weight: 800;\n    line-height: 1;\n    margin-bottom: 8px;\n    color: var(--text-color);\n}\n.srd-card-label {\n    font-size: 13px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    color: var(--text-muted);\n}\n.qty-badge {\n    font-size: 13px;\n    font-weight: 500;\n    vertical-align: middle;\n    margin-left: 5px;\n    padding: 2px 6px;\n    background: var(--bg-light-gray);\n    border-radius: 6px;\n}\n\n.srd-indicator {\n    height: 4px;\n    width: 0;\n    border-radius: 4px;\n    margin-top: 15px;\n    opacity: 0;\n    transition: all 0.3s ease;\n}\n\n/* Card Themes */\n.card-release.active {\n    background: linear-gradient(145deg, var(--card-bg), #f0fdf4); \n    border-left: 4px solid var(--green-500);\n}\n[data-theme=\"dark\"] .card-release.active { background: linear-gradient(145deg, var(--card-bg), rgba(34, 197, 94, 0.1)); }\n.card-release.active .srd-card-count { color: var(--green-600); }\n.card-release .srd-indicator { background-color: var(--green-500); }\n\n.card-approval.active {\n    background: linear-gradient(145deg, var(--card-bg), #eff6ff);\n    border-left: 4px solid var(--blue-500);\n}\n[data-theme=\"dark\"] .card-approval.active { background: linear-gradient(145deg, var(--card-bg), rgba(59, 130, 246, 0.1)); }\n.card-approval.active .srd-card-count { color: var(--blue-600); }\n.card-approval .srd-indicator { background-color: var(--blue-500); }\n\n.card-locked.active {\n    background: linear-gradient(145deg, var(--card-bg), #fef2f2);\n    border-left: 4px solid var(--red-500);\n}\n[data-theme=\"dark\"] .card-locked.active { background: linear-gradient(145deg, var(--card-bg), rgba(239, 68, 68, 0.1)); }\n.card-locked.active .srd-card-count { color: var(--red-600); }\n.card-locked .srd-indicator { background-color: var(--red-500); }\n\n/* Table */\n.srd-body {\n    background: var(--card-bg);\n    border-radius: 12px;\n    box-shadow: var(--card-shadow);\n    overflow: hidden;\n}\n.srd-table {\n    margin: 0;\n    width: 100%;\n    border-collapse: separate;\n    border-spacing: 0;\n}\n.srd-table thead th {\n    background-color: var(--bg-light-gray);\n    color: var(--text-muted);\n    font-weight: 600;\n    text-transform: uppercase;\n    font-size: 11px;\n    letter-spacing: 0.5px;\n    border-bottom: 1px solid var(--border-color);\n    padding: 12px 20px;\n    border-top: none;\n}\n.srd-table tbody td {\n    padding: 16px 20px;\n    vertical-align: middle;\n    border-bottom: 1px solid var(--border-color);\n    color: var(--text-color);\n    font-size: 13px;\n    transition: background 0.2s;\n}\n.srd-table tbody tr:last-child td {\n    border-bottom: none;\n}\n.srd-table tbody tr:hover td {\n    background-color: var(--bg-light-gray);\n}\n.badge-date {\n    background: var(--bg-light-gray);\n    color: var(--text-muted);\n    padding: 4px 8px;\n    border-radius: 6px;\n    font-weight: normal;\n}\n\n/* Action Buttons */\n.btn-action {\n    border-radius: 6px;\n    padding: 4px 10px;\n    font-weight: 600;\n    border: none;\n    display: inline-flex;\n    align-items: center;\n    gap: 5px;\n    transition: all 0.2s;\n}\n.btn-success-subtle { background: #dcfce7; color: #166534; }\n.btn-success-subtle:hover { background: #bbf7d0; color: #14532d; }\n\n.btn-primary-subtle { background: #dbeafe; color: #1e40af; }\n.btn-primary-subtle:hover { background: #bfdbfe; color: #1e3a8a; }\n\n.btn-danger-subtle { background: #fee2e2; color: #991b1b; }\n.btn-danger-subtle:hover { background: #fecaca; color: #7f1d1d; }\n\n[data-theme=\"dark\"] .btn-success-subtle { background: rgba(34, 197, 94, 0.2); color: #86efac; }\n[data-theme=\"dark\"] .btn-success-subtle:hover { background: rgba(34, 197, 94, 0.3); }\n[data-theme=\"dark\"] .btn-primary-subtle { background: rgba(59, 130, 246, 0.2); color: #93c5fd; }\n[data-theme=\"dark\"] .btn-primary-subtle:hover { background: rgba(59, 130, 246, 0.3); }\n[data-theme=\"dark\"] .btn-danger-subtle { background: rgba(239, 68, 68, 0.2); color: #fca5a5; }\n[data-theme=\"dark\"] .btn-danger-subtle:hover { background: rgba(239, 68, 68, 0.3); }\n\n/* Pagination */\n.srd-pagination {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 15px 20px;\n    border-top: 1px solid var(--border-color);\n    background: var(--bg-light-gray);\n}\n\n.srd-page-info {\n    font-size: 13px;\n    color: var(--text-muted);\n    font-weight: 500;\n}\n\n.srd-page-controls {\n    display: flex;\n    align-items: center;\n    gap: 15px;\n}\n\n.srd-page-number {\n    font-size: 13px;\n    color: var(--text-color);\n    font-weight: 600;\n}\n\n.btn-page-prev,\n.btn-page-next {\n    border-radius: 6px;\n    padding: 6px 12px;\n    transition: all 0.2s;\n    border: 1px solid var(--border-color);\n    background: white;\n}\n\n.btn-page-prev:hover:not(:disabled),\n.btn-page-next:hover:not(:disabled) {\n    background: var(--primary-color);\n    color: white;\n    border-color: var(--primary-color);\n}\n\n.btn-page-prev:disabled,\n.btn-page-next:disabled {\n    opacity: 0.4;\n    cursor: not-allowed;\n}\n\n/* Utilities */\n.p-5 { padding: 3rem !important; }"
 },
 {
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<div class=\"sales-manager-dashboard\">\n  <!-- Header -->\n  <div class=\"dashboard-header\">\n    <h2 class=\"dashboard-title\">Sales Manager Dashboard</h2>\n    <div class=\"last-updated\">Last updated: <span id=\"last-update-time\">--</span></div>\n  </div>\n  \n  <!-- Total Stats Cards -->\n  <div class=\"stats-grid\">\n    <div class=\"stat-card stat-card-primary\">\n      <div class=\"stat-icon\">üìä</div>\n      <div class=\"stat-content\">\n        <div class=\"stat-value\" id=\"total-orders\">--</div>\n        <div class=\"stat-label\">Total Orders</div>\n      </div>\n    </div>\n    \n    <div class=\"stat-card stat-card-success\">\n      <div class=\"stat-icon\">üí∞</div>\n      <div class=\"stat-content\">\n        <div class=\"stat-value\" id=\"total-revenue\">--</div>\n        <div class=\"stat-label\">Total Revenue</div>\n      </div>\n    </div>\n    \n    <div class=\"stat-card stat-card-warning\">\n      <div class=\"stat-icon\">üì¶</div>\n      <div class=\"stat-content\">\n        <div class=\"stat-value\" id=\"total-stock-value\">--</div>\n        <div class=\"stat-label\">Total Stock Value</div>\n      </div>\n    </div>\n    \n    <div class=\"stat-card stat-card-info\">\n      <div class=\"stat-icon\">üéØ</div>\n      <div class=\"stat-content\">\n        <div class=\"stat-value\" id=\"pending-orders\">--</div>\n        <div class=\"stat-label\">Pending Orders</div>\n      </div>\n    </div>\n  </div>\n  \n  <!-- Orders Section -->\n  <div class=\"section-card\">\n    <div class=\"section-header\">\n      <h3 class=\"section-title\">Recent Orders</h3>\n      <button class=\"refresh-btn\" onclick=\"refreshOrders()\">\n        <span class=\"refresh-icon\">üîÑ</span> Refresh\n      </button>\n    </div>\n    <div class=\"table-container\">\n      <table class=\"data-table\">\n        <thead>\n          <tr>\n            <th>Order ID</th>\n            <th>Customer</th>\n            <th>Salesperson</th>\n            <th>Date</th>\n            <th>Quantity</th>\n            <th>Price</th>\n            <th>Total</th>\n            <th>Status</th>\n          </tr>\n        </thead>\n        <tbody id=\"orders-tbody\">\n          <tr class=\"loading-row\">\n            <td colspan=\"8\" class=\"text-center\">\n              <div class=\"loading-spinner\"></div>\n              <div>Loading orders...</div>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n    <!-- Orders Pagination -->\n    <div class=\"table-pagination\">\n      <div class=\"page-info\">\n        <span id=\"orders-page-info\">Showing 0 of 0</span>\n      </div>\n      <div class=\"page-controls\">\n        <button class=\"btn-page-prev\" id=\"orders-prev\" disabled>\n          <svg class=\"icon icon-xs\"><use href=\"#icon-left\"></use></svg> Prev\n        </button>\n        <span class=\"page-number\">Page <span id=\"orders-current-page\">1</span></span>\n        <button class=\"btn-page-next\" id=\"orders-next\" disabled>\n          Next <svg class=\"icon icon-xs\"><use href=\"#icon-right\"></use></svg>\n        </button>\n      </div>\n    </div>\n  </div>\n  \n  <!-- Stock Section -->\n  <div class=\"section-card\">\n    <div class=\"section-header\">\n      <h3 class=\"section-title\">Stock Overview</h3>\n      <button class=\"refresh-btn\" onclick=\"refreshStock()\">\n        <span class=\"refresh-icon\">üîÑ</span> Refresh\n      </button>\n    </div>\n    <div class=\"table-container\">\n      <table class=\"data-table\">\n        <thead>\n          <tr>\n            <th>Item Code</th>\n            <th>Item Name</th>\n            <th>Warehouse</th>\n            <th>Quantity</th>\n            <th>Unit Price</th>\n            <th>Total Value</th>\n            <th>Stock Status</th>\n          </tr>\n        </thead>\n        <tbody id=\"stock-tbody\">\n          <tr class=\"loading-row\">\n            <td colspan=\"7\" class=\"text-center\">\n              <div class=\"loading-spinner\"></div>\n              <div>Loading stock...</div>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n    <!-- Stock Pagination -->\n    <div class=\"table-pagination\">\n      <div class=\"page-info\">\n        <span id=\"stock-page-info\">Showing 0 of 0</span>\n      </div>\n      <div class=\"page-controls\">\n        <button class=\"btn-page-prev\" id=\"stock-prev\" disabled>\n          <svg class=\"icon icon-xs\"><use href=\"#icon-left\"></use></svg> Prev\n        </button>\n        <span class=\"page-number\">Page <span id=\"stock-current-page\">1</span></span>\n        <button class=\"btn-page-next\" id=\"stock-next\" disabled>\n          Next <svg class=\"icon icon-xs\"><use href=\"#icon-right\"></use></svg>\n        </button>\n      </div>\n    </div>\n  </div>\n</div>",
  "modified": "2026-02-01 09:53:54.556631",
  "name": "Sales Manager Board",
  "private": 0,
  "roles": [
   {
    "parent": "Sales Manager Board",
    "parentfield": "roles",
    "parenttype": "Custom HTML Block",
    "role": "Sales Manager"
   }
  ],
  "script": "frappe.provide('sales_manager_dashboard');\n\nsales_manager_dashboard = {\n  root: null,\n  allOrders: [],\n  allStock: [],\n  ordersPage: 1,\n  stockPage: 1,\n  rowsPerPage: 5,\n  \n  // Initialize the dashboard\n  init: function(root_element) {\n    this.root = root_element;\n    this.setupPaginationListeners();\n    this.loadDashboardData();\n    this.updateTimestamp();\n    \n    // Auto-refresh every 5 minutes\n    setInterval(() => {\n      this.loadDashboardData();\n      this.updateTimestamp();\n    }, 300000);\n  },\n  \n  // Setup pagination button listeners\n  setupPaginationListeners: function() {\n    const ordersPrev = this.root.querySelector('#orders-prev');\n    const ordersNext = this.root.querySelector('#orders-next');\n    const stockPrev = this.root.querySelector('#stock-prev');\n    const stockNext = this.root.querySelector('#stock-next');\n    \n    if (ordersPrev) {\n      ordersPrev.addEventListener('click', (e) => {\n        e.preventDefault();\n        if (this.ordersPage > 1) {\n          this.ordersPage--;\n          this.renderOrdersPage();\n        }\n      });\n    }\n    \n    if (ordersNext) {\n      ordersNext.addEventListener('click', (e) => {\n        e.preventDefault();\n        const totalPages = Math.ceil(this.allOrders.length / this.rowsPerPage);\n        if (this.ordersPage < totalPages) {\n          this.ordersPage++;\n          this.renderOrdersPage();\n        }\n      });\n    }\n    \n    if (stockPrev) {\n      stockPrev.addEventListener('click', (e) => {\n        e.preventDefault();\n        if (this.stockPage > 1) {\n          this.stockPage--;\n          this.renderStockPage();\n        }\n      });\n    }\n    \n    if (stockNext) {\n      stockNext.addEventListener('click', (e) => {\n        e.preventDefault();\n        const totalPages = Math.ceil(this.allStock.length / this.rowsPerPage);\n        if (this.stockPage < totalPages) {\n          this.stockPage++;\n          this.renderStockPage();\n        }\n      });\n    }\n  },\n  \n  // Update the last updated timestamp\n  updateTimestamp: function() {\n    const now = new Date();\n    const timeString = now.toLocaleString('en-US', {\n      hour: '2-digit',\n      minute: '2-digit',\n      second: '2-digit',\n      hour12: true\n    });\n    const updateEl = this.root.querySelector('#last-update-time');\n    if (updateEl) {\n      updateEl.textContent = timeString;\n    }\n  },\n  \n  // Load all dashboard data\n  loadDashboardData: function() {\n    frappe.call({\n      method: 'systech.services.api.get_dashboard_data',\n      callback: (r) => {\n        if (r.message) {\n          this.updateStats(r.message.stats);\n          this.allOrders = r.message.orders || [];\n          this.allStock = r.message.stock || [];\n          this.ordersPage = 1;\n          this.stockPage = 1;\n          this.renderOrdersPage();\n          this.renderStockPage();\n        }\n      },\n      error: (r) => {\n        console.error('Error loading dashboard data:', r);\n        if (r.exc && r.exc.includes('Access Denied')) {\n          const dashboard = this.root.querySelector('.sales-manager-dashboard');\n          if (dashboard) {\n            dashboard.innerHTML = \n              '<div class=\"text-center\" style=\"padding: 60px; background: white; border-radius: 16px; margin: 24px;\">' +\n              '<h3 style=\"color: #dc2626; margin-bottom: 12px;\">üîí Access Denied</h3>' +\n              '<p style=\"color: #6b7280;\">This dashboard is only accessible to Sales Managers.</p>' +\n              '</div>';\n          }\n        }\n      }\n    });\n  },\n  \n  // Update statistics\n  updateStats: function(stats) {\n    this.updateElement('#total-orders', stats.total_orders || 0);\n    this.updateElement('#pending-orders', stats.pending_orders || 0);\n    this.updateElement('#total-revenue', this.formatCurrency(stats.total_revenue, stats.currency));\n    this.updateElement('#total-stock-value', this.formatCurrency(stats.total_stock_value, stats.currency));\n  },\n  \n  // Helper to update element text\n  updateElement: function(selector, text) {\n    const el = this.root.querySelector(selector);\n    if (el) {\n      el.textContent = text;\n    }\n  },\n  \n  // Render orders page\n  renderOrdersPage: function() {\n    const totalRows = this.allOrders.length;\n    const totalPages = Math.ceil(totalRows / this.rowsPerPage);\n    const startIndex = (this.ordersPage - 1) * this.rowsPerPage;\n    const endIndex = Math.min(startIndex + this.rowsPerPage, totalRows);\n    const pageData = this.allOrders.slice(startIndex, endIndex);\n    \n    this.updateOrders(pageData);\n    this.updateOrdersPagination(startIndex, endIndex, totalRows, totalPages);\n  },\n  \n  // Update orders pagination controls\n  updateOrdersPagination: function(start, end, total, totalPages) {\n    const pageInfo = this.root.querySelector('#orders-page-info');\n    const currentPage = this.root.querySelector('#orders-current-page');\n    const prevBtn = this.root.querySelector('#orders-prev');\n    const nextBtn = this.root.querySelector('#orders-next');\n    \n    if (pageInfo) {\n      pageInfo.textContent = total > 0 ? `Showing ${start + 1}-${end} of ${total}` : 'Showing 0 of 0';\n    }\n    if (currentPage) {\n      currentPage.textContent = this.ordersPage;\n    }\n    if (prevBtn) {\n      prevBtn.disabled = this.ordersPage <= 1;\n    }\n    if (nextBtn) {\n      nextBtn.disabled = this.ordersPage >= totalPages || total === 0;\n    }\n  },\n  \n  // Render stock page\n  renderStockPage: function() {\n    const totalRows = this.allStock.length;\n    const totalPages = Math.ceil(totalRows / this.rowsPerPage);\n    const startIndex = (this.stockPage - 1) * this.rowsPerPage;\n    const endIndex = Math.min(startIndex + this.rowsPerPage, totalRows);\n    const pageData = this.allStock.slice(startIndex, endIndex);\n    \n    this.updateStock(pageData);\n    this.updateStockPagination(startIndex, endIndex, totalRows, totalPages);\n  },\n  \n  // Update stock pagination controls\n  updateStockPagination: function(start, end, total, totalPages) {\n    const pageInfo = this.root.querySelector('#stock-page-info');\n    const currentPage = this.root.querySelector('#stock-current-page');\n    const prevBtn = this.root.querySelector('#stock-prev');\n    const nextBtn = this.root.querySelector('#stock-next');\n    \n    if (pageInfo) {\n      pageInfo.textContent = total > 0 ? `Showing ${start + 1}-${end} of ${total}` : 'Showing 0 of 0';\n    }\n    if (currentPage) {\n      currentPage.textContent = this.stockPage;\n    }\n    if (prevBtn) {\n      prevBtn.disabled = this.stockPage <= 1;\n    }\n    if (nextBtn) {\n      nextBtn.disabled = this.stockPage >= totalPages || total === 0;\n    }\n  },\n  \n  // Update orders table\n  updateOrders: function(orders) {\n    const tbody = this.root.querySelector('#orders-tbody');\n    if (!tbody) return;\n    \n    tbody.innerHTML = '';\n    \n    if (!orders || orders.length === 0) {\n      tbody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center\">No orders found</td></tr>';\n      return;\n    }\n    \n    orders.forEach(order => {\n      const statusClass = this.getStatusClass(order.status);\n      const unitPrice = order.total_qty > 0 ? order.base_net_total / order.total_qty : 0;\n      const row = document.createElement('tr');\n      row.innerHTML = `\n        <td><a href=\"/app/sales-order/${order.name}\" target=\"_blank\">${order.name}</a></td>\n        <td>${order.customer || '-'}</td>\n        <td>${order.sales_person || '-'}</td>\n        <td>${this.formatDate(order.transaction_date)}</td>\n        <td>${this.formatNumber(order.total_qty || 0)}</td>\n        <td class=\"price-cell\">${this.formatCurrency(unitPrice, order.currency)}</td>\n        <td class=\"price-cell\">${this.formatCurrency(order.grand_total, order.currency)}</td>\n        <td><span class=\"status-badge ${statusClass}\">${order.status || 'Draft'}</span></td>\n      `;\n      tbody.appendChild(row);\n    });\n  },\n  \n  // Update stock table\n  updateStock: function(stock) {\n    const tbody = this.root.querySelector('#stock-tbody');\n    if (!tbody) return;\n    \n    tbody.innerHTML = '';\n    \n    if (!stock || stock.length === 0) {\n      tbody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center\">No stock found</td></tr>';\n      return;\n    }\n    \n    stock.forEach(item => {\n      const stockStatus = this.getStockStatus(item.actual_qty);\n      const row = document.createElement('tr');\n      row.innerHTML = `\n        <td><a href=\"/app/item/${item.item_code}\" target=\"_blank\">${item.item_code}</a></td>\n        <td>${item.item_name || item.item_code}</td>\n        <td>${item.warehouse || '-'}</td>\n        <td>${this.formatNumber(item.actual_qty || 0)}</td>\n        <td class=\"price-cell\">${this.formatCurrency(item.valuation_rate || 0)}</td>\n        <td class=\"price-cell\">${this.formatCurrency(item.total_value || 0)}</td>\n        <td><span class=\"status-badge ${stockStatus.class}\">${stockStatus.text}</span></td>\n      `;\n      tbody.appendChild(row);\n    });\n  },\n  \n  // Helper function to format currency\n  formatCurrency: function(amount, currency) {\n    if (amount == null || amount === undefined) amount = 0;\n    currency = currency || frappe.boot.sysdefaults.currency || 'USD';\n    return format_currency(amount, currency);\n  },\n  \n  // Helper function to format number\n  formatNumber: function(num) {\n    if (num == null || num === undefined) return '0';\n    return parseFloat(num).toLocaleString('en-US', {\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 2\n    });\n  },\n  \n  // Helper function to format date\n  formatDate: function(dateStr) {\n    if (!dateStr) return '-';\n    return frappe.datetime.str_to_user(dateStr);\n  },\n  \n  // Helper function to get status class\n  getStatusClass: function(status) {\n    const statusMap = {\n      'Draft': 'status-pending',\n      'Submitted': 'status-submitted',\n      'To Deliver and Bill': 'status-confirmed',\n      'To Bill': 'status-confirmed',\n      'To Deliver': 'status-confirmed',\n      'Completed': 'status-confirmed',\n      'Cancelled': 'status-cancelled'\n    };\n    return statusMap[status] || 'status-pending';\n  },\n  \n  // Helper function to get stock status\n  getStockStatus: function(qty) {\n    if (qty <= 0) {\n      return { text: 'Out of Stock', class: 'status-out-of-stock' };\n    } else if (qty < 10) {\n      return { text: 'Low Stock', class: 'status-low-stock' };\n    } else {\n      return { text: 'In Stock', class: 'status-in-stock' };\n    }\n  },\n  \n  // Refresh data\n  refresh: function() {\n    this.loadDashboardData();\n    this.updateTimestamp();\n  }\n};\n\n// Attach refresh functions to window for button onclick handlers\nwindow.refreshOrders = function() {\n  if (sales_manager_dashboard.root) {\n    sales_manager_dashboard.refresh();\n  }\n};\n\nwindow.refreshStock = function() {\n  if (sales_manager_dashboard.root) {\n    sales_manager_dashboard.refresh();\n  }\n};\n\n// Initialize dashboard using root_element\nsales_manager_dashboard.init(root_element);",
  "style": "/* Import Google Fonts */\n@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');\n\n.sales-manager-dashboard {\n  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n  padding: 24px;\n  background: #ffffff;\n  min-height: 100vh;\n  color: #000000;\n}\n\n/* Header Styles */\n.dashboard-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 32px;\n  padding-bottom: 16px;\n  border-bottom: 2px solid rgba(99, 102, 241, 0.1);\n}\n\n.dashboard-title {\n  font-size: 32px;\n  font-weight: 700;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n  margin: 0;\n}\n\n.last-updated {\n  font-size: 14px;\n  color: #4a5568;\n  font-weight: 500;\n}\n\n/* Stats Grid */\n.stats-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n  gap: 20px;\n  margin-bottom: 32px;\n}\n\n.stat-card {\n  background: white;\n  border-radius: 16px;\n  padding: 24px;\n  display: flex;\n  align-items: center;\n  gap: 20px;\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  position: relative;\n  overflow: hidden;\n  border: 1px solid #e2e8f0;\n}\n\n.stat-card::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 4px;\n  background: linear-gradient(90deg, var(--card-color-1), var(--card-color-2));\n  opacity: 0;\n  transition: opacity 0.3s ease;\n}\n\n.stat-card:hover {\n  transform: translateY(-4px);\n  box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1), 0 4px 8px rgba(0, 0, 0, 0.06);\n}\n\n.stat-card:hover::before {\n  opacity: 1;\n}\n\n.stat-card-primary {\n  --card-color-1: #667eea;\n  --card-color-2: #764ba2;\n}\n\n.stat-card-success {\n  --card-color-1: #10b981;\n  --card-color-2: #059669;\n}\n\n.stat-card-warning {\n  --card-color-1: #f59e0b;\n  --card-color-2: #d97706;\n}\n\n.stat-card-info {\n  --card-color-1: #3b82f6;\n  --card-color-2: #2563eb;\n}\n\n.stat-icon {\n  font-size: 48px;\n  line-height: 1;\n  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));\n}\n\n.stat-content {\n  flex: 1;\n}\n\n.stat-value {\n  font-size: 28px;\n  font-weight: 700;\n  color: #000000;\n  margin-bottom: 4px;\n}\n\n.stat-label {\n  font-size: 14px;\n  color: #4a5568;\n  font-weight: 500;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n\n/* Section Card */\n.section-card {\n  background: white;\n  border-radius: 16px;\n  padding: 24px;\n  margin-bottom: 24px;\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);\n  border: 1px solid #e2e8f0;\n}\n\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20px;\n}\n\n.section-title {\n  font-size: 20px;\n  font-weight: 600;\n  color: #000000;\n  margin: 0;\n}\n\n.refresh-btn {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 10px 20px;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n  border: none;\n  border-radius: 8px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  font-size: 14px;\n}\n\n.refresh-btn:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n}\n\n.refresh-icon {\n  display: inline-block;\n  transition: transform 0.5s ease;\n}\n\n.refresh-btn:hover .refresh-icon {\n  transform: rotate(180deg);\n}\n\n/* Table Styles */\n.table-container {\n  overflow-x: auto;\n  border-radius: 8px;\n  border: 1px solid #e2e8f0;\n}\n\n.data-table {\n  width: 100%;\n  border-collapse: collapse;\n  font-size: 14px;\n}\n\n.data-table thead {\n  background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);\n}\n\n.data-table th {\n  padding: 16px;\n  text-align: left;\n  font-weight: 600;\n  color: #000000;\n  text-transform: uppercase;\n  font-size: 12px;\n  letter-spacing: 0.5px;\n  border-bottom: 2px solid #e2e8f0;\n}\n\n.data-table td {\n  padding: 16px;\n  border-bottom: 1px solid #f1f5f9;\n  color: #2d3748;\n}\n\n.data-table tbody tr {\n  transition: background-color 0.2s ease;\n}\n\n.data-table tbody tr:hover {\n  background-color: #f8fafc;\n}\n\n.data-table tbody tr:last-child td {\n  border-bottom: none;\n}\n\n/* Pagination Styles */\n.table-pagination {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 15px 20px;\n  margin-top: 16px;\n  border-top: 1px solid #e2e8f0;\n  background: #f8fafc;\n  border-radius: 0 0 8px 8px;\n}\n\n.page-info {\n  font-size: 13px;\n  color: #4a5568;\n  font-weight: 500;\n}\n\n.page-controls {\n  display: flex;\n  align-items: center;\n  gap: 15px;\n}\n\n.page-number {\n  font-size: 13px;\n  color: #000000;\n  font-weight: 600;\n}\n\n.btn-page-prev,\n.btn-page-next {\n  border-radius: 6px;\n  padding: 6px 12px;\n  transition: all 0.2s;\n  border: 1px solid #cbd5e0;\n  background: white;\n  color: #2d3748;\n  font-weight: 500;\n  cursor: pointer;\n  font-size: 13px;\n  display: flex;\n  align-items: center;\n  gap: 4px;\n}\n\n.btn-page-prev:hover:not(:disabled),\n.btn-page-next:hover:not(:disabled) {\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n  border-color: #667eea;\n}\n\n.btn-page-prev:disabled,\n.btn-page-next:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n}\n\n/* Status Badges */\n.status-badge {\n  display: inline-block;\n  padding: 4px 12px;\n  border-radius: 12px;\n  font-size: 12px;\n  font-weight: 600;\n  text-transform: uppercase;\n  letter-spacing: 0.3px;\n}\n\n.status-submitted {\n  background-color: #dbeafe;\n  color: #1e40af;\n}\n\n.status-confirmed {\n  background-color: #d1fae5;\n  color: #065f46;\n}\n\n.status-pending {\n  background-color: #fef3c7;\n  color: #92400e;\n}\n\n.status-cancelled {\n  background-color: #fee2e2;\n  color: #991b1b;\n}\n\n.status-in-stock {\n  background-color: #d1fae5;\n  color: #065f46;\n}\n\n.status-low-stock {\n  background-color: #fef3c7;\n  color: #92400e;\n}\n\n.status-out-of-stock {\n  background-color: #fee2e2;\n  color: #991b1b;\n}\n\n/* Loading Spinner */\n.loading-spinner {\n  width: 40px;\n  height: 40px;\n  border: 4px solid #e2e8f0;\n  border-top-color: #667eea;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n  margin: 20px auto;\n}\n\n@keyframes spin {\n  to { transform: rotate(360deg); }\n}\n\n.text-center {\n  text-align: center;\n  color: #4a5568;\n  padding: 40px 20px !important;\n}\n\n/* Price Formatting */\n.price-cell {\n  font-weight: 600;\n  color: #059669;\n}\n\n/* Link Styling */\n.data-table a {\n  color: #667eea;\n  text-decoration: none;\n  font-weight: 500;\n  transition: color 0.2s ease;\n}\n\n.data-table a:hover {\n  color: #764ba2;\n  text-decoration: underline;\n}\n\n/* Responsive Design */\n@media (max-width: 768px) {\n  .sales-manager-dashboard {\n    padding: 16px;\n  }\n  \n  .dashboard-header {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 12px;\n  }\n  \n  .dashboard-title {\n    font-size: 24px;\n  }\n  \n  .stats-grid {\n    grid-template-columns: 1fr;\n    gap: 16px;\n  }\n  \n  .section-header {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 12px;\n  }\n  \n  .refresh-btn {\n    width: 100%;\n    justify-content: center;\n  }\n  \n  .table-container {\n    font-size: 12px;\n  }\n  \n  .data-table th,\n  .data-table td {\n    padding: 12px 8px;\n  }\n  \n  .table-pagination {\n    flex-direction: column;\n    gap: 12px;\n  }\n}"
 }
]