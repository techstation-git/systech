[
 {
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<div class=\"srd-dashboard\">\n    <div class=\"srd-header\">\n        <h4 class=\"srd-title\">Stock Release Console</h4>\n        <div class=\"srd-actions\">\n            <button class=\"btn btn-default btn-sm btn-refresh icon-btn\" title=\"Refresh\">\n                <svg class=\"icon icon-sm\"><use href=\"#icon-refresh\"></use></svg>\n            </button>\n        </div>\n    </div>\n\n    <!-- Stats Cards -->\n    <div class=\"row srd-stats\">\n        <div class=\"col-xs-4\">\n            <div class=\"srd-card card-release\" data-state=\"Release Requested\">\n                <div class=\"srd-icon-bg\">\n                    <svg class=\"icon icon-xl\"><use href=\"#icon-unlock\"></use></svg>\n                </div>\n                <div class=\"srd-card-content\">\n                    <div class=\"srd-card-count\" id=\"count-release\">0</div>\n                    <div class=\"srd-card-label\">Release Requested</div>\n                    <div class=\"srd-indicator\"></div>\n                </div>\n            </div>\n        </div>\n        <div class=\"col-xs-4\">\n            <div class=\"srd-card card-approval\" data-state=\"Pending Manager Approval\">\n                <div class=\"srd-icon-bg\">\n                    <svg class=\"icon icon-xl\"><use href=\"#icon-review\"></use></svg>\n                </div>\n                <div class=\"srd-card-content\">\n                    <div class=\"srd-card-count\" id=\"count-approval\">0</div>\n                    <div class=\"srd-card-label\">Pending Approval</div>\n                    <div class=\"srd-indicator\"></div>\n                </div>\n            </div>\n        </div>\n        <div class=\"col-xs-4\">\n            <div class=\"srd-card card-locked\" data-state=\"Locked\">\n                 <div class=\"srd-icon-bg\">\n                    <svg class=\"icon icon-xl\"><use href=\"#icon-lock\"></use></svg>\n                </div>\n                <div class=\"srd-card-content\">\n                    <div class=\"srd-card-count\">\n                        <span id=\"count-locked\">0</span>\n                        <small class=\"text-muted qty-badge\" title=\"Total Reserved Quantity\">\n                            <svg class=\"icon icon-xs\"><use href=\"#icon-box\"></use></svg> <span id=\"qty-locked\">0</span>\n                        </small>\n                    </div>\n                    <div class=\"srd-card-label\">Reserved Stock</div>\n                    <div class=\"srd-indicator\"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <!-- List -->\n    <div class=\"srd-body\">\n        <div class=\"table-responsive\">\n            <table class=\"table srd-table\">\n                <thead>\n                    <tr>\n                        <th style=\"width: 25%\">Sales Order</th>\n                        <th style=\"width: 30%\">Customer</th>\n                        <th style=\"width: 15%\">Date</th>\n                        <th style=\"width: 15%\" class=\"text-right\">Amount</th>\n                        <th style=\"width: 15%\" class=\"text-right\">Action</th>\n                    </tr>\n                </thead>\n                <tbody id=\"srd-table-body\">\n                    <tr><td colspan=\"5\" class=\"text-center text-muted p-5\">Loading data...</td></tr>\n                </tbody>\n            </table>\n        </div>\n    </div>\n</div>",
  "modified": "2026-01-15 11:31:01.873196",
  "name": "Sales Manager Dashboard",
  "private": 0,
  "roles": [],
  "script": "// (Logic remains largely the same, just updated card selectors if needed)\nconst $root = $(root_element);\nconst $tbody = $root.find('#srd-table-body');\nconst $refreshBtn = $root.find('.btn-refresh');\nconst $cards = $root.find('.srd-card');\nlet currentState = 'Release Requested';\n// Set initial active state visual\n$root.find(`.srd-card[data-state=\"${currentState}\"]`).addClass('active');\nfunction refreshDashboard() {\n    loadStats();\n    loadList(currentState);\n}\nfunction loadStats() {\n    frappe.call({\n        method: 'systech.services.rest.get_dashboard_stats',\n        callback: function(r) {\n            if (r.message) {\n                const s = r.message;\n                $root.find('#count-release').text(s.release || 0);\n                $root.find('#count-approval').text(s.approval || 0);\n                $root.find('#count-locked').text(s.locked_count || 0);\n                $root.find('#qty-locked').text(s.locked_qty || 0);\n            }\n        }\n    });\n}\nfunction loadList(state) {\n    currentState = state;\n    $tbody.html('<tr><td colspan=\"5\" class=\"text-center text-muted p-5\">Loading...</td></tr>');\n    \n    // Update active card visual\n    $cards.removeClass('active');\n    $root.find(`.srd-card[data-state=\"${state}\"]`).addClass('active');\n    // Filter Logic\n    const filters = {\n        workflow_state: state,\n        docstatus: ['!=', 2] \n    };\n    \n    // Specifically for Locked, we only want active/open ones (not closed)\n    if (state === 'Locked') {\n        filters.status = ['!=', 'Closed'];\n        filters.docstatus = 1;\n    }\n    frappe.call({\n        method: 'frappe.client.get_list',\n        args: {\n            doctype: 'Sales Order',\n            filters: filters,\n            fields: ['name', 'customer', 'transaction_date', 'grand_total', 'currency', 'total_qty'],\n            order_by: 'transaction_date asc'\n        },\n        callback: function(r) {\n            if (r.message && r.message.length > 0) {\n                renderTable(r.message);\n            } else {\n                $tbody.html('<tr><td colspan=\"5\" class=\"text-center text-muted p-5\">No records found.</td></tr>');\n            }\n        }\n    });\n}\nfunction renderTable(data) {\n    let rows = '';\n    \n    // Determine Action Button configuration\n    let actionLabel = '';\n    let actionMethod = ''; \n    let actionCmd = '';\n    let btnClass = '';\n    let btnIcon = '';\n    if (currentState === 'Release Requested') {\n        actionLabel = 'Release';\n        actionMethod = 'workflow';\n        actionCmd = 'Release';\n        btnClass = 'btn-success-subtle'; // Custom class\n        btnIcon = 'unlock';\n    } else if (currentState === 'Pending Manager Approval') {\n        actionLabel = 'Approve';\n        actionMethod = 'workflow';\n        actionCmd = 'Approve';\n        btnClass = 'btn-primary-subtle';\n        btnIcon = 'check';\n    } else if (currentState === 'Locked') {\n        actionLabel = 'Unreserve';\n        actionMethod = 'unreserve'; \n        btnClass = 'btn-danger-subtle';\n        btnIcon = 'x';\n    }\n    data.forEach(d => {\n        const date = frappe.datetime.str_to_user(d.transaction_date);\n        const amount = format_currency(d.grand_total, d.currency);\n        \n        let actionBtnHtml = '';\n        if (actionLabel) {\n             actionBtnHtml = `\n                <button class=\"btn btn-xs ${btnClass} btn-action\" \n                    data-name=\"${d.name}\" \n                    data-method=\"${actionMethod}\"\n                    data-cmd=\"${actionCmd}\">\n                    <svg class=\"icon icon-xs\"><use href=\"#icon-${btnIcon}\"></use></svg> ${actionLabel}\n                </button>\n             `;\n        }\n        rows += `\n            <tr>\n                <td>\n                    <a href=\"/app/sales-order/${d.name}\" class=\"fw-bold text-dark\" style=\"font-weight:600;\" data-doctype=\"Sales Order\" data-name=\"${d.name}\">\n                        ${d.name}\n                    </a>\n                </td>\n                <td>\n                    <span class=\"text-muted text-truncate\" style=\"max-width: 200px; display:inline-block; vertical-align:middle;\">\n                        ${d.customer}\n                    </span>\n                </td>\n                <td><span class=\"badge badge-date\">${date}</span></td>\n                <td class=\"text-right font-weight-bold\">${amount}</td>\n                <td class=\"text-right\">${actionBtnHtml}</td>\n            </tr>\n        `;\n    });\n    $tbody.html(rows);\n    $tbody.find('.btn-action').on('click', function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const sales_order = $(this).data('name');\n        const method = $(this).data('method');\n        const cmd = $(this).data('cmd');\n        \n        if (method === 'unreserve') {\n            processUnreserve(sales_order);\n        } else {\n            processWorkflow(sales_order, cmd);\n        }\n    });\n}\nfunction processWorkflow(sales_order, action) {\n    frappe.confirm(`Are you sure you want to <b>${action}</b> ${sales_order}?`, () => {\n        frappe.call({\n            method: 'systech.services.rest.process_workflow_action',\n            args: { docname: sales_order, action: action },\n            freeze: true,\n            callback: function(r) {\n                if (!r.exc) {\n                    frappe.show_alert({message: __('Action applied successfully'), indicator: 'green'});\n                    refreshDashboard();\n                }\n            }\n        });\n    });\n}\nfunction processUnreserve(sales_order) {\n    frappe.confirm(`Are you sure you want to <b>Unreserve and Close</b> ${sales_order}?`, () => {\n        frappe.call({\n            method: 'systech.services.rest.unreserve_stock',\n            args: { sales_order_name: sales_order },\n            freeze: true,\n            callback: function(r) {\n                if (!r.exc) {\n                    frappe.show_alert({message: __('Stock Unreserved'), indicator: 'orange'});\n                    refreshDashboard();\n                }\n            }\n        });\n    });\n}\nconst $body = $('body');\n// Event Listeners\n$refreshBtn.on('click', refreshDashboard);\n$cards.on('click', function() {\n    const state = $(this).data('state');\n    loadList(state);\n});\n// Initial load\nrefreshDashboard();",
  "style": "/* Layout & Basics */\n.srd-dashboard {\n    font-family: 'Inter', -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n    color: var(--text-color);\n}\n.srd-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 25px;\n    padding: 0 5px;\n}\n.srd-title {\n    margin: 0;\n    font-size: 20px;\n    font-weight: 700;\n    letter-spacing: -0.5px;\n}\n\n/* Cards Container - FORCED SINGLE ROW */\n.srd-stats {\n    display: flex !important;\n    flex-wrap: nowrap !important; /* Forces single line */\n    gap: 20px;\n    margin-bottom: 30px;\n    margin-left: 0; \n    margin-right: 0;\n    width: 100%;\n}\n/* Ensure proper column spacing override */\n.srd-stats > div {\n    flex: 1; /* Equal width */\n    max-width: 33.33%;\n    padding-left: 0 !important;\n    padding-right: 0 !important;\n    margin-bottom: 0 !important;\n}\n\n/* Base Card Style */\n.srd-card {\n    background: var(--card-bg);\n    padding: 24px;\n    border-radius: 16px;\n    position: relative;\n    overflow: hidden;\n    cursor: pointer;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.03);\n    border: 1px solid var(--border-color);\n    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n}\n\n.srd-card:hover {\n    transform: translateY(-4px);\n    box-shadow: 0 12px 24px rgba(0,0,0,0.06);\n}\n\n/* Active State - General */\n.srd-card.active {\n    border-color: transparent;\n    box-shadow: 0 8px 20px rgba(0,0,0,0.08);\n}\n.srd-card.active .srd-indicator {\n    width: 60%; \n    opacity: 1;\n}\n\n/* Card Icons Background */\n.srd-icon-bg {\n    position: absolute;\n    right: -10px;\n    top: -10px;\n    opacity: 0.05;\n    transform: rotate(15deg) scale(1.5);\n    transition: all 0.5s ease;\n}\n.srd-card:hover .srd-icon-bg {\n    transform: rotate(0deg) scale(1.6);\n    opacity: 0.08;\n}\n\n/* Card Content Typography */\n.srd-card-count {\n    font-size: 32px;\n    font-weight: 800;\n    line-height: 1;\n    margin-bottom: 8px;\n    color: var(--text-color);\n}\n.srd-card-label {\n    font-size: 13px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    color: var(--text-muted);\n}\n.qty-badge {\n    font-size: 13px;\n    font-weight: 500;\n    vertical-align: middle;\n    margin-left: 5px;\n    padding: 2px 6px;\n    background: var(--bg-light-gray);\n    border-radius: 6px;\n}\n\n/* Active Indicator Line */\n.srd-indicator {\n    height: 4px;\n    width: 0;\n    border-radius: 4px;\n    margin-top: 15px;\n    opacity: 0;\n    transition: all 0.3s ease;\n}\n\n/* Specific Card Themes */\n/* Release Requested - Green Theme */\n.card-release.active {\n    background: linear-gradient(145deg, var(--card-bg), #f0fdf4); \n    border-left: 4px solid var(--green-500);\n}\n[data-theme=\"dark\"] .card-release.active { background: linear-gradient(145deg, var(--card-bg), rgba(34, 197, 94, 0.1)); }\n.card-release.active .srd-card-count { color: var(--green-600); }\n.card-release .srd-indicator { background-color: var(--green-500); }\n\n/* Pending Approval - Blue Theme */\n.card-approval.active {\n    background: linear-gradient(145deg, var(--card-bg), #eff6ff);\n    border-left: 4px solid var(--blue-500);\n}\n[data-theme=\"dark\"] .card-approval.active { background: linear-gradient(145deg, var(--card-bg), rgba(59, 130, 246, 0.1)); }\n.card-approval.active .srd-card-count { color: var(--blue-600); }\n.card-approval .srd-indicator { background-color: var(--blue-500); }\n\n/* Locked - Red/Orange Theme */\n.card-locked.active {\n    background: linear-gradient(145deg, var(--card-bg), #fef2f2);\n    border-left: 4px solid var(--red-500);\n}\n[data-theme=\"dark\"] .card-locked.active { background: linear-gradient(145deg, var(--card-bg), rgba(239, 68, 68, 0.1)); }\n.card-locked.active .srd-card-count { color: var(--red-600); }\n.card-locked .srd-indicator { background-color: var(--red-500); }\n\n/* Table Styles */\n.srd-body {\n    background: var(--card-bg);\n    border-radius: 12px;\n    box-shadow: var(--card-shadow);\n    overflow: hidden; /* For rounded corners */\n}\n.srd-table {\n    margin: 0;\n    width: 100%;\n    border-collapse: separate;\n    border-spacing: 0;\n}\n.srd-table thead th {\n    background-color: var(--bg-light-gray);\n    color: var(--text-muted);\n    font-weight: 600;\n    text-transform: uppercase;\n    font-size: 11px;\n    letter-spacing: 0.5px;\n    border-bottom: 1px solid var(--border-color);\n    padding: 12px 20px;\n    border-top: none;\n}\n.srd-table tbody td {\n    padding: 16px 20px;\n    vertical-align: middle;\n    border-bottom: 1px solid var(--border-color);\n    color: var(--text-color);\n    font-size: 13px;\n    transition: background 0.2s;\n}\n.srd-table tbody tr:last-child td {\n    border-bottom: none;\n}\n.srd-table tbody tr:hover td {\n    background-color: var(--bg-light-gray);\n}\n.badge-date {\n    background: var(--bg-light-gray);\n    color: var(--text-muted);\n    padding: 4px 8px;\n    border-radius: 6px;\n    font-weight: normal;\n}\n\n/* Action Buttons */\n.btn-action {\n    border-radius: 6px;\n    padding: 4px 10px;\n    font-weight: 600;\n    border: none;\n    display: inline-flex;\n    align-items: center;\n    gap: 5px;\n    transition: all 0.2s;\n}\n.btn-success-subtle { background: #dcfce7; color: #166534; }\n.btn-success-subtle:hover { background: #bbf7d0; color: #14532d; }\n\n.btn-primary-subtle { background: #dbeafe; color: #1e40af; }\n.btn-primary-subtle:hover { background: #bfdbfe; color: #1e3a8a; }\n\n.btn-danger-subtle { background: #fee2e2; color: #991b1b; }\n.btn-danger-subtle:hover { background: #fecaca; color: #7f1d1d; }\n\n/* Dark Mode Adjustments */\n[data-theme=\"dark\"] .btn-success-subtle { background: rgba(34, 197, 94, 0.2); color: #86efac; }\n[data-theme=\"dark\"] .btn-success-subtle:hover { background: rgba(34, 197, 94, 0.3); }\n[data-theme=\"dark\"] .btn-primary-subtle { background: rgba(59, 130, 246, 0.2); color: #93c5fd; }\n[data-theme=\"dark\"] .btn-primary-subtle:hover { background: rgba(59, 130, 246, 0.3); }\n[data-theme=\"dark\"] .btn-danger-subtle { background: rgba(239, 68, 68, 0.2); color: #fca5a5; }\n[data-theme=\"dark\"] .btn-danger-subtle:hover { background: rgba(239, 68, 68, 0.3); }\n\n/* Utilities */\n.p-5 { padding: 3rem !important; }"
 }
]